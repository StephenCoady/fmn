<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>fmn.lib.defaults &#8212; FMN 1.0.0 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '1.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for fmn.lib.defaults</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">fmn.lib.models</span>

<span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="c1"># This is a list of rules that we&#39;ll use to exclude certain message types.</span>
<span class="c1"># Our defaults work by saying first &quot;give me any message mentioning my username</span>
<span class="c1"># or any package that I maintain *except* for messages that match any of the</span>
<span class="c1"># following exclusion rules&quot;.  These lists are broken into three kinds:</span>
<span class="c1"># - exclusion_packages (rules to exclude a message if it matches a package of</span>
<span class="c1">#                       mine).</span>
<span class="c1"># - exclusion_username (rules to exclude a message if it matches my username).</span>
<span class="c1"># - exclusion_mutual (rules to exclude a message for both of the default</span>
<span class="c1">#                     filters)</span>

<span class="n">exclusion_packages</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># Ignore all taskotron messages (we have a separate filter for this).</span>
    <span class="c1"># https://phab.qadevel.cloud.fedoraproject.org/T673</span>
    <span class="c1"># https://github.com/fedora-infra/fmn.lib/pull/58</span>
    <span class="s1">&#39;taskotron_result_new&#39;</span><span class="p">,</span>

    <span class="c1"># Ignore cvsadmin batch stuff.</span>
    <span class="c1"># See https://github.com/fedora-infra/fmn/issues/45</span>
    <span class="s1">&#39;git_pkgdb2branch_start&#39;</span><span class="p">,</span>
    <span class="s1">&#39;git_pkgdb2branch_complete&#39;</span><span class="p">,</span>

    <span class="c1"># Ignore the fedora tagger message by default</span>
    <span class="c1"># See https://github.com/fedora-infra/fmn/issues/79</span>
    <span class="s1">&#39;fedoratagger_catchall&#39;</span><span class="p">,</span>

    <span class="c1"># Ignore the highest-frequency/lowest-occurence ABRT messages (spam)</span>
    <span class="s1">&#39;faf_report_threshold1&#39;</span><span class="p">,</span>
    <span class="s1">&#39;faf_problem_threshold1&#39;</span><span class="p">,</span>

    <span class="c1"># Ignore admin requests to start a new mash</span>
    <span class="c1"># https://github.com/fedora-infra/fmn/issues/103</span>
    <span class="s1">&#39;bodhi_masher_start&#39;</span><span class="p">,</span>

    <span class="c1"># Ignore mdapi repo changes (really spammy for the koji rawhide repo!)</span>
    <span class="s1">&#39;mdapi_repo_update&#39;</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">exclusion_username</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># No need to notify about your own askbot activity</span>
    <span class="s1">&#39;askbot_catchall&#39;</span><span class="p">,</span>

    <span class="c1"># Don&#39;t tell me about my own bodhi activity, but do tell me if other people</span>
    <span class="c1"># do bodhi stuff to my packages.</span>
    <span class="s1">&#39;bodhi_catchall&#39;</span><span class="p">,</span>

    <span class="c1"># Don&#39;t tell me about my own bugzilla activity, but I do want to know if</span>
    <span class="c1"># other people act on bugs on my packages.</span>
    <span class="s1">&#39;bugzilla_catchall&#39;</span><span class="p">,</span>

    <span class="c1"># Exclude fedorahosted notifications by default.  No need to notify me of</span>
    <span class="c1"># my own activity.</span>
    <span class="s1">&#39;trac_catchall&#39;</span><span class="p">,</span>

    <span class="c1"># Ignore dist-git scm messages if I am responsible for them, but I *do*</span>
    <span class="c1"># want to get notified if someone else pushes to a package that I own.</span>
    <span class="s1">&#39;git_catchall&#39;</span><span class="p">,</span>

    <span class="c1"># Don&#39;t bother notifying me of my own github activity</span>
    <span class="s1">&#39;github_catchall&#39;</span><span class="p">,</span>

    <span class="c1"># Ignore all FMN stuff that you do yourself.</span>
    <span class="s1">&#39;fmn_catchall&#39;</span><span class="p">,</span>

    <span class="c1"># Ignore all meetbot stuff about meetings I am involved in.  bochecha</span>
    <span class="c1"># pointed it out that this was ridiculous.</span>
    <span class="s1">&#39;meetbot_catchall&#39;</span><span class="p">,</span>

    <span class="c1">## No need to notify me about any fedocal stuff that I do.</span>
    <span class="s1">&#39;fedocal_catchall&#39;</span><span class="p">,</span>

    <span class="c1">## Go ahead and ignore all pkgdb stuff that *I* do myself, but I do want to</span>
    <span class="c1">## be notified if someone else does something with respect to one of my</span>
    <span class="c1">## packages there.</span>
    <span class="s1">&#39;pkgdb_catchall&#39;</span><span class="p">,</span>

    <span class="c1"># Ignore all of my own tagger stuff</span>
    <span class="s1">&#39;fedoratagger_catchall&#39;</span><span class="p">,</span>

    <span class="c1"># Ignore all of my own wiki stuff.</span>
    <span class="s1">&#39;wiki_catchall&#39;</span><span class="p">,</span>

    <span class="c1"># Ignore the spammy fedbadges stuff, but keep the badge.award message</span>
    <span class="s1">&#39;fedbadges_person_first_login&#39;</span><span class="p">,</span>
    <span class="s1">&#39;fedbadges_person_rank_advance&#39;</span><span class="p">,</span>

    <span class="c1">## Go ahead and ignore all mailman stuff since you should be getting it by</span>
    <span class="c1">## email anyways.</span>
    <span class="s1">&#39;mailman_receive&#39;</span><span class="p">,</span>
<span class="p">]</span>
<span class="n">exclusion_mutual</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># No need to tell me about copr starts, I just want to know about completed</span>
    <span class="c1"># stuff.</span>
    <span class="c1">#&#39;copr_build_end&#39;,</span>
    <span class="c1">#&#39;copr_build_failed&#39;,</span>
    <span class="c1">#&#39;copr_build_skipped&#39;,</span>
    <span class="s1">&#39;copr_build_start&#39;</span><span class="p">,</span>
    <span class="c1">#&#39;copr_build_success&#39;,</span>
    <span class="s1">&#39;copr_chroot_start&#39;</span><span class="p">,</span>
    <span class="s1">&#39;copr_worker_create&#39;</span><span class="p">,</span>

    <span class="c1">## No need to tell me about any fedora-elections stuff, but this should</span>
    <span class="c1">## never match anyways (it won&#39;t relate to my username or a package of</span>
    <span class="c1">## mine).  Comment it out here to keep the list shorter and easier to read</span>
    <span class="c1">## for users.</span>
    <span class="c1">#&#39;fedora_elections_candidate_new&#39;,</span>
    <span class="c1">#&#39;fedora_elections_candidate_delete&#39;,</span>
    <span class="c1">#&#39;fedora_elections_candidate_edit&#39;,</span>
    <span class="c1">#&#39;fedora_elections_election_new&#39;,</span>
    <span class="c1">#&#39;fedora_elections_election_edit&#39;,</span>

    <span class="c1">## Actually, I want to know about *all* fas stuff since its so</span>
    <span class="c1">## account-sensitive.  i.e., if someone else changes my fas details, I want</span>
    <span class="c1">## to be notified.</span>
    <span class="c1">#&#39;fas_group_update&#39;,</span>
    <span class="c1">#&#39;fas_group_member_apply&#39;,</span>
    <span class="c1">#&#39;fas_user_create&#39;,</span>
    <span class="c1">#&#39;fas_group_member_sponsor&#39;,</span>
    <span class="c1">#&#39;fas_user_update&#39;,</span>
    <span class="c1">#&#39;fas_group_member_remove&#39;,</span>
    <span class="c1">#&#39;fas_role_update&#39;,</span>
    <span class="c1">#&#39;fas_group_create&#39;,</span>

    <span class="c1">## No need to notify about any fedimg stuff, but this should never match</span>
    <span class="c1">## anyways so we leave it out to keep the list shorter.</span>
    <span class="c1">#&#39;fedimg_image_test_completed&#39;,</span>
    <span class="c1">#&#39;fedimg_image_test_failed&#39;,</span>
    <span class="c1">#&#39;fedimg_image_test_started&#39;,</span>
    <span class="c1">#&#39;fedimg_image_test_state&#39;,</span>
    <span class="c1">#&#39;fedimg_image_upload_completed&#39;,</span>
    <span class="c1">#&#39;fedimg_image_upload_failed&#39;,</span>
    <span class="c1">#&#39;fedimg_image_upload_started&#39;,</span>
    <span class="c1">#&#39;fedimg_image_upload_state&#39;,</span>

    <span class="c1">## I *do* want to be notified of *all* my own jenkins activity.</span>
    <span class="c1">#&#39;jenkins_build_aborted&#39;,</span>
    <span class="c1">#&#39;jenkins_build_unstable&#39;,</span>
    <span class="c1">#&#39;jenkins_build_failed&#39;,</span>
    <span class="c1">#&#39;jenkins_build_start&#39;,</span>
    <span class="c1">#&#39;jenkins_build_passed&#39;,</span>
    <span class="c1">#&#39;jenkins_build_notbuilt&#39;,</span>

    <span class="c1">## Pretty cool to get notifications of your own kerneltest uploads.</span>
    <span class="c1">#&#39;kerneltest_upload_new&#39;,</span>
    <span class="c1">#&#39;kerneltest_release_new&#39;,</span>
    <span class="c1">#&#39;kerneltest_release_edit&#39;,</span>

    <span class="c1">## Here, only ignore koji builds that are **starting**.  We *do*</span>
    <span class="c1">## want to get notified of all builds that finish (in any way:  success,</span>
    <span class="c1">## failure, or cancellation).</span>
    <span class="c1">#&#39;koji_scratch_build_cancelled&#39;,</span>
    <span class="c1">#&#39;koji_scratch_build_state_change&#39;,</span>
    <span class="c1">#&#39;koji_scratch_build_completed&#39;,</span>
    <span class="c1">#&#39;koji_scratch_build_failed&#39;,</span>
    <span class="s1">&#39;koji_scratch_build_started&#39;</span><span class="p">,</span>
    <span class="c1">#&#39;koji_build_cancelled&#39;,</span>
    <span class="c1">#&#39;koji_build_state_change&#39;,</span>
    <span class="c1">#&#39;koji_build_completed&#39;,</span>
    <span class="c1">#&#39;koji_build_deleted&#39;,</span>
    <span class="c1">#&#39;koji_build_failed&#39;,</span>
    <span class="s1">&#39;koji_build_started&#39;</span><span class="p">,</span>

    <span class="c1">## Lastly, we can hide all of this &quot;behind the scenes&quot; stuff from users.</span>
    <span class="s1">&#39;koji_rpm_sign&#39;</span><span class="p">,</span>
    <span class="s1">&#39;koji_tag&#39;</span><span class="p">,</span>
    <span class="s1">&#39;koji_untag&#39;</span><span class="p">,</span>
    <span class="s1">&#39;koji_repo_done&#39;</span><span class="p">,</span>
    <span class="s1">&#39;koji_repo_init&#39;</span><span class="p">,</span>
    <span class="s1">&#39;koji_package_list_change&#39;</span><span class="p">,</span>

    <span class="c1">## Don&#39;t hide any koschei stuff from users.  It is pretty interesting stuff</span>
    <span class="c1">#&#39;koschei_group&#39;,</span>
    <span class="c1">#&#39;koschei_package_state_change&#39;,</span>

    <span class="c1">## I actually want to know about all the nuancier stuff associated with me,</span>
    <span class="c1">## if I&#39;m ever in an election.</span>
    <span class="c1">#&#39;nuancier_candidate_new&#39;,</span>
    <span class="c1">#&#39;nuancier_candidate_approved&#39;,</span>
    <span class="c1">#&#39;nuancier_election_new&#39;,</span>
    <span class="c1">#&#39;nuancier_candidate_denied&#39;,</span>
    <span class="c1">#&#39;nuancier_election_update&#39;,</span>

    <span class="c1">## Ignore all the compose stuff.. but this can be commented out since</span>
    <span class="c1">## compose messages are associated with neither a username nor a package.</span>
    <span class="c1">#&#39;compose_branched_complete&#39;,</span>
    <span class="c1">#&#39;compose_epelbeta_complete&#39;,</span>
    <span class="c1">#&#39;compose_rawhide_complete&#39;,</span>
    <span class="c1">#&#39;compose_branched_start&#39;,</span>
    <span class="c1">#&#39;compose_rawhide_start&#39;,</span>
    <span class="c1">#&#39;compose_branched_mash_complete&#39;,</span>
    <span class="c1">#&#39;compose_rawhide_mash_complete&#39;,</span>
    <span class="c1">#&#39;compose_branched_mash_start&#39;,</span>
    <span class="c1">#&#39;compose_rawhide_mash_start&#39;,</span>
    <span class="c1">#&#39;compose_branched_pungify_complete&#39;,</span>
    <span class="c1">#&#39;compose_rawhide_pungify_complete&#39;,</span>
    <span class="c1">#&#39;compose_branched_pungify_start&#39;,</span>
    <span class="c1">#&#39;compose_rawhide_pungify_start&#39;,</span>
    <span class="c1">#&#39;compose_branched_rsync_complete&#39;,</span>
    <span class="c1">#&#39;compose_rawhide_rsync_complete&#39;,</span>
    <span class="c1">#&#39;compose_branched_rsync_start&#39;,</span>
    <span class="c1">#&#39;compose_rawhide_rsync_start&#39;,</span>

    <span class="c1"># Go ahead and ignore all summershum messages by default.  @jwboyer</span>
    <span class="c1"># complained rightly https://github.com/fedora-infra/fmn/issues/27</span>
    <span class="s1">&#39;summershum_catchall&#39;</span><span class="p">,</span>

    <span class="c1"># Ignore all anitya stuff:</span>
    <span class="c1"># - don&#39;t notify me about my own actions there</span>
    <span class="c1"># - don&#39;t notify me about updates to my packages, because the-new-hotness</span>
    <span class="c1">#   will already do that if I enabled monitoring of my packages in pkgdb</span>
    <span class="s1">&#39;anitya_catchall&#39;</span><span class="p">,</span>
<span class="p">]</span>


<div class="viewcode-block" id="create_defaults_for"><a class="viewcode-back" href="../../../reference/fmn.lib.html#fmn.lib.defaults.create_defaults_for">[docs]</a><span class="k">def</span> <span class="nf">create_defaults_for</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">only_for</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">detail_values</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Create a sizable amount of defaults for a new user. &quot;&quot;&quot;</span>

    <span class="n">detail_values</span> <span class="o">=</span> <span class="n">detail_values</span> <span class="ow">or</span> <span class="p">{}</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">user</span><span class="o">.</span><span class="n">openid</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.fedoraproject.org&#39;</span><span class="p">):</span>
        <span class="n">log</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;New user not from fedoraproject.org.  No defaults set.&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="c1"># the openid is of the form USERNAME.id.fedoraproject.org</span>
    <span class="n">nick</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">openid</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># TODO -- make the root here configurable.</span>
    <span class="n">valid_paths</span> <span class="o">=</span> <span class="n">fmn</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">load_rules</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="s1">&#39;fmn.rules&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">rule_maker</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Shorthand function, used inside loops below. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">fmn</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Rule</span><span class="o">.</span><span class="n">create_from_code_path</span><span class="p">(</span>
            <span class="n">session</span><span class="p">,</span> <span class="n">valid_paths</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">contexts</span><span class="p">():</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">,</span> <span class="s1">&#39;irc&#39;</span><span class="p">,</span> <span class="s1">&#39;sse&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">only_for</span><span class="p">:</span>
            <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">only_for</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
            <span class="n">context</span> <span class="o">=</span> <span class="n">fmn</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">context</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">context</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;No such context </span><span class="si">%r</span><span class="s2"> is in the DB.&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>

    <span class="c1"># For each context, build one little and two big filters</span>
    <span class="k">for</span> <span class="n">context</span> <span class="ow">in</span> <span class="n">contexts</span><span class="p">():</span>
        <span class="n">pref</span> <span class="o">=</span> <span class="n">fmn</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Preference</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">pref</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">detail_values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">pref</span> <span class="o">=</span> <span class="n">fmn</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Preference</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
                <span class="n">session</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">detail_value</span><span class="o">=</span><span class="n">value</span><span class="p">)</span>

        <span class="c1"># Add a filter that looks for packages of this user</span>
        <span class="n">filt</span> <span class="o">=</span> <span class="n">fmn</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Filter</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
            <span class="n">session</span><span class="p">,</span> <span class="s2">&quot;Events on packages that I own&quot;</span><span class="p">)</span>
        <span class="n">filt</span><span class="o">.</span><span class="n">add_rule</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">valid_paths</span><span class="p">,</span>
                      <span class="s2">&quot;fmn.rules:user_package_filter&quot;</span><span class="p">,</span> <span class="n">fasnick</span><span class="o">=</span><span class="n">nick</span><span class="p">)</span>

        <span class="c1"># If this is a message about a package of mine, **and** i&#39;m responsible</span>
        <span class="c1"># for it, then don&#39;t trigger this filter.  Rely on the previous one.</span>
        <span class="n">filt</span><span class="o">.</span><span class="n">add_rule</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">valid_paths</span><span class="p">,</span>
                      <span class="s2">&quot;fmn.rules:user_filter&quot;</span><span class="p">,</span>
                      <span class="n">fasnick</span><span class="o">=</span><span class="n">nick</span><span class="p">,</span>
                      <span class="n">negated</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Right off the bat, ignore all messages from non-primary kojis.</span>
        <span class="n">filt</span><span class="o">.</span><span class="n">add_rule</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">valid_paths</span><span class="p">,</span>
                      <span class="s2">&quot;fmn.rules:koji_instance&quot;</span><span class="p">,</span>
                      <span class="n">instance</span><span class="o">=</span><span class="s2">&quot;ppc,s390,arm&quot;</span><span class="p">,</span>
                      <span class="n">negated</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># And furthermore, exclude lots of message types</span>
        <span class="k">for</span> <span class="n">code_path</span> <span class="ow">in</span> <span class="n">exclusion_packages</span> <span class="o">+</span> <span class="n">exclusion_mutual</span><span class="p">:</span>
            <span class="n">filt</span><span class="o">.</span><span class="n">add_rule</span><span class="p">(</span>
                <span class="n">session</span><span class="p">,</span> <span class="n">valid_paths</span><span class="p">,</span> <span class="s2">&quot;fmn.rules:</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">code_path</span><span class="p">,</span> <span class="n">negated</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">pref</span><span class="o">.</span><span class="n">add_filter</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">filt</span><span class="p">,</span> <span class="n">notify</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># END &quot;packages I own&quot;</span>

        <span class="c1"># Add a filter that looks for this user</span>
        <span class="n">filt</span> <span class="o">=</span> <span class="n">fmn</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Filter</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
            <span class="n">session</span><span class="p">,</span> <span class="s2">&quot;Events referring to my username&quot;</span><span class="p">)</span>
        <span class="n">filt</span><span class="o">.</span><span class="n">add_rule</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">valid_paths</span><span class="p">,</span>
                      <span class="s2">&quot;fmn.rules:user_filter&quot;</span><span class="p">,</span> <span class="n">fasnick</span><span class="o">=</span><span class="n">nick</span><span class="p">)</span>

        <span class="c1"># Right off the bat, ignore all messages from non-primary kojis.</span>
        <span class="n">filt</span><span class="o">.</span><span class="n">add_rule</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">valid_paths</span><span class="p">,</span>
                      <span class="s2">&quot;fmn.rules:koji_instance&quot;</span><span class="p">,</span>
                      <span class="n">instance</span><span class="o">=</span><span class="s2">&quot;ppc,s390,arm&quot;</span><span class="p">,</span>
                      <span class="n">negated</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># And furthermore exclude lots of message types</span>
        <span class="k">for</span> <span class="n">code_path</span> <span class="ow">in</span> <span class="n">exclusion_username</span> <span class="o">+</span> <span class="n">exclusion_mutual</span><span class="p">:</span>
            <span class="n">filt</span><span class="o">.</span><span class="n">add_rule</span><span class="p">(</span>
                <span class="n">session</span><span class="p">,</span> <span class="n">valid_paths</span><span class="p">,</span> <span class="s2">&quot;fmn.rules:</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">code_path</span><span class="p">,</span> <span class="n">negated</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">pref</span><span class="o">.</span><span class="n">add_filter</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">filt</span><span class="p">,</span> <span class="n">notify</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># END &quot;events references my username&quot;</span>

        <span class="c1"># Add a taskotron filter</span>
        <span class="n">filt</span> <span class="o">=</span> <span class="n">fmn</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Filter</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
            <span class="n">session</span><span class="p">,</span> <span class="s2">&quot;Critical taskotron tasks on my packages&quot;</span><span class="p">)</span>
        <span class="n">filt</span><span class="o">.</span><span class="n">add_rule</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">valid_paths</span><span class="p">,</span>
                      <span class="s2">&quot;fmn.rules:user_package_filter&quot;</span><span class="p">,</span>
                      <span class="n">fasnick</span><span class="o">=</span><span class="n">nick</span><span class="p">)</span>
        <span class="n">filt</span><span class="o">.</span><span class="n">add_rule</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">valid_paths</span><span class="p">,</span>
                      <span class="s2">&quot;fmn.rules:taskotron_release_critical_task&quot;</span><span class="p">)</span>
        <span class="n">filt</span><span class="o">.</span><span class="n">add_rule</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">valid_paths</span><span class="p">,</span>
                      <span class="s2">&quot;fmn.rules:taskotron_task_particular_or_changed_outcome&quot;</span><span class="p">,</span>
                      <span class="n">outcome</span><span class="o">=</span><span class="s1">&#39;FAILED&#39;</span><span class="p">)</span>
        <span class="n">pref</span><span class="o">.</span><span class="n">add_filter</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">filt</span><span class="p">,</span> <span class="n">notify</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  <li><a href="../lib.html">fmn.lib</a><ul>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016, Red Hat, Inc. and others.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.5.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.9</a>
      
    </div>

    

    
  </body>
</html>